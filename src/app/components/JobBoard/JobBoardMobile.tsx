"use client"
import { useStore } from "@/app/useStore"
import { useMemo } from "react"

export default function JobBoardMobile() {
    const { jobs } = useStore();

    const imageNumbers = useMemo(() => {
        const maxImages = 11;
        const totalJobs = jobs?.length || 0;

        // Helper: shuffle array
        const shuffle = (arr: number[]) => arr.sort(() => Math.random() - 0.5);

        const result: number[] = [];
        let pool = shuffle(Array.from({ length: maxImages }, (_, i) => i + 1));

        for (let i = 0; i < totalJobs; i++) {
            if (pool.length === 0) {
                pool = shuffle(Array.from({ length: maxImages }, (_, i) => i + 1));
            }

            const next = pool.pop()!;
            if (i > 0 && next === result[i - 1]) {
                if (pool.length > 0) {
                    const alt = pool.pop()!;
                    pool.push(next); 
                    result.push(alt);
                } else {
                    result.push(next);
                }
            } else {
                result.push(next);
            }
        }

        return result;
    }, [jobs]);

    return (
        <div className="block md:hidden relative w-full h-fit">
            <p className="font-reckless relative text-[15vw] tracking-[-1vw] text-center z-[11] py-[150px] text-title">
                Open Jobs
            </p>

            {/* gradient */}
            <div className="absolute top-0 left-0 w-screen h-full bg-[linear-gradient(180deg,#232323_20%,#3263CD_80.29%)]" />

            {/* glass bg */}
            <img
                src="jobboard/jobboard-bg.webp"
                alt="Job Board Glass Tile Background"
                className="min-w-[180vw] absolute top-[100px] left-1/2 translate-x-[-50%] mix-blend-plus-lighter [mask-image:linear-gradient(to_bottom,transparent_25%,black_100%)] [mask-size:100%_100%] [mask-repeat:no-repeat]"
            />

            <div className="relative flex flex-col z-10">
                <img src="jobboard/jobboard-top.webp" className="w-full h-full" />

                <svg xmlns="http://www.w3.org/2000/svg" className="absolute left-1/2 translate-x-[-50%] top-[15vw] w-[40vw]" viewBox="0 0 196 29" fill="none">
                <g clip-path="url(#clip0_50_32)">
                    <path d="M0.495077 28.5127L15.2922 0.489258H25.4612L30.5269 28.5127H21.5452L21.0698 24.5614H11.4934L9.67362 28.5127H0.492981H0.495077ZM14.3833 18.2885H20.318L19.8029 13.809C19.7506 13.3477 19.6982 12.8864 19.6437 12.4251C19.5914 11.9638 19.5306 11.509 19.4657 11.0606C19.3987 10.6122 19.3401 10.1574 19.2877 9.69605C19.2354 9.23474 19.183 8.77343 19.1286 8.31212H18.9694C18.7055 8.90924 18.4291 9.51282 18.138 10.125C17.847 10.7351 17.5643 11.3473 17.2879 11.9573C17.0114 12.5674 16.7266 13.1861 16.4376 13.8112L14.3791 18.2906L14.3833 18.2885Z" fill="#DDD5CB"/>
                    <path d="M33.8502 28.5127L38.6373 0.489258H55.2961C57.1431 0.489258 58.6718 0.814761 59.8864 1.46577C61.0989 2.11678 62.0035 2.97904 62.5961 4.05255C63.1888 5.12607 63.4861 6.32677 63.4861 7.6568C63.4861 9.39426 63.2286 10.9011 62.7155 12.1772C62.2004 13.4534 61.4884 14.5333 60.5795 15.415C59.6686 16.2967 58.6068 17.0231 57.3943 17.5944L60.8769 28.5106H51.1832L48.6514 19.1012H44.2202L42.5973 28.5106H33.8523L33.8502 28.5127ZM45.2862 12.8713H51.024C51.5518 12.8713 52.0795 12.7161 52.6072 12.4036C53.1349 12.091 53.5705 11.6642 53.9139 11.1209C54.2574 10.5777 54.4291 9.95473 54.4291 9.24768C54.4291 8.54062 54.2448 7.97153 53.8742 7.53609C53.5035 7.1028 53.0156 6.88508 52.4104 6.88508H46.2767L45.2883 12.8735L45.2862 12.8713Z" fill="#DDD5CB"/>
                    <path d="M64.6337 28.5127L69.4209 0.489258H86.0796C87.9267 0.489258 89.4553 0.814761 90.6699 1.46577C91.8824 2.11678 92.7871 2.97904 93.3797 4.05255C93.9724 5.12607 94.2697 6.32677 94.2697 7.6568C94.2697 9.39426 94.0122 10.9011 93.4991 12.1772C92.9839 13.4534 92.272 14.5333 91.3631 15.415C90.4522 16.2967 89.3904 17.0231 88.1779 17.5944L91.6605 28.5106H81.9668L79.435 19.1012H75.0038L73.3809 28.5106H64.6358L64.6337 28.5127ZM76.0697 12.8713H81.8076C82.3353 12.8713 82.8631 12.7161 83.3908 12.4036C83.9185 12.091 84.3541 11.6642 84.6975 11.1209C85.0409 10.5777 85.2126 9.95473 85.2126 9.24768C85.2126 8.54062 85.0284 7.97153 84.6577 7.53609C84.2871 7.1028 83.7991 6.88508 83.1939 6.88508H77.0603L76.0718 12.8735L76.0697 12.8713Z" fill="#DDD5CB"/>
                    <path d="M95.3796 28.5127L100.207 0.489258H108.952L104.125 28.5127H95.3796Z" fill="#DDD5CB"/>
                    <path d="M117.418 28.5128L112.591 0.489338H121.613L123.156 13.4427C123.208 13.7962 123.275 14.3114 123.353 14.9904C123.432 15.6694 123.518 16.3894 123.61 17.1482C123.703 17.9092 123.788 18.6011 123.868 19.2263H124.027C124.343 18.5753 124.647 17.9307 124.938 17.2905C125.227 16.6524 125.524 16.0079 125.828 15.3547C126.132 14.7037 126.427 14.0656 126.718 13.4405L132.732 0.487183H141.991L127.547 28.5107H117.418V28.5128Z" fill="#DDD5CB"/>
                    <path d="M140.763 28.5127L145.59 0.489258H169.135L167.987 7.21058H153.188L152.516 11.08H165.177L164.069 17.5146H151.408L150.656 21.7914H165.732L164.584 28.5127H140.763Z" fill="#DDD5CB"/>
                    <path d="M181.955 29C180.135 29 178.447 28.8836 176.889 28.6529C175.333 28.4222 173.98 28.0364 172.833 27.491C171.685 26.9478 170.789 26.1868 170.142 25.2103C169.495 24.2338 169.172 23.0116 169.172 21.5436C169.172 21.1642 169.191 20.7503 169.231 20.3019C169.271 19.8535 169.342 19.4267 169.449 19.0193H177.718C177.614 19.237 177.547 19.4461 177.522 19.6509C177.494 19.8535 177.482 20.0518 177.482 20.2415C177.482 20.8667 177.653 21.3474 177.997 21.688C178.34 22.0286 178.814 22.2592 179.421 22.3799C180.028 22.5028 180.713 22.5632 181.479 22.5632C181.875 22.5632 182.311 22.5438 182.786 22.5028C183.261 22.4619 183.716 22.3735 184.151 22.2377C184.587 22.1019 184.943 21.8906 185.22 21.6061C185.496 21.3215 185.634 20.9335 185.634 20.4442C185.634 20.0109 185.45 19.6509 185.079 19.3642C184.709 19.0796 184.208 18.8339 183.576 18.6313C182.943 18.4286 182.231 18.2389 181.44 18.06C180.648 17.8833 179.829 17.6871 178.987 17.4694C178.064 17.2258 177.147 16.9326 176.238 16.5942C175.327 16.2557 174.51 15.8138 173.786 15.2706C173.059 14.7274 172.479 14.0419 172.045 13.2141C171.61 12.3863 171.392 11.3753 171.392 10.179C171.392 8.30569 171.775 6.72344 172.54 5.43436C173.304 4.14528 174.32 3.09979 175.587 2.29788C176.853 1.49814 178.263 0.913955 179.821 0.547494C181.377 0.181033 182.947 -0.00219727 184.531 -0.00219727C186.114 -0.00219727 187.682 0.140076 189.081 0.424622C190.48 0.709168 191.692 1.15108 192.721 1.74819C193.749 2.34531 194.553 3.09979 195.135 4.00947C195.715 4.91916 196.006 5.99914 196.006 7.24726C196.006 7.46498 195.994 7.70857 195.967 7.98019C195.939 8.2518 195.887 8.63119 195.807 9.12053H187.617C187.642 8.93083 187.657 8.78856 187.657 8.69371V8.3876C187.657 7.76246 187.427 7.22571 186.964 6.77949C186.501 6.33111 185.718 6.10692 184.61 6.10692C183.739 6.10692 183.008 6.20824 182.413 6.41303C181.821 6.61566 181.377 6.87434 181.088 7.18691C180.797 7.49948 180.652 7.83145 180.652 8.18497C180.652 8.5385 180.757 8.83598 180.968 9.08173C181.18 9.32531 181.484 9.5495 181.879 9.75429C182.275 9.95907 182.742 10.1358 183.285 10.2846C183.825 10.4333 184.426 10.5777 185.085 10.7114C186.114 10.9291 187.203 11.1943 188.35 11.5047C189.498 11.8172 190.572 12.2441 191.575 12.7873C192.578 13.3305 193.389 14.044 194.009 14.9257C194.628 15.8074 194.938 16.9283 194.938 18.2864C194.938 20.0518 194.589 21.6061 193.889 22.949C193.19 24.2942 192.233 25.413 191.02 26.3097C189.806 27.2065 188.421 27.8769 186.865 28.3252C185.31 28.7736 183.674 28.9978 181.959 28.9978L181.955 29Z" fill="#DDD5CB"/>
                </g>
                <defs>
                    <clipPath id="clip0_50_32">
                    <rect width="196" height="29" fill="white"/>
                    </clipPath>
                </defs>
            </svg>

                <div className="w-full h-full bg-[#232323]">
                    <p className="text-white font-progLightIta text-[14px] ml-[20px] mt-[10px] mb-[10px]">
                        TITLE AND LOCATION
                    </p>

                    {jobs.map((job: any, index: number) => (
                        <a className="w-full h-full" href={job.apply} target="_blank" >
                        <div
                            key={index}
                            className="cursor-pointer transition-colors duration-150 group w-[calc(100%-20px)] h-fit flex p-[10px] bg-[#303032] hover:bg-white shadow-[inset_0_1px_8.1px_0_rgba(0,0,0,0.5)] mx-[10px] items-center"
                        >
                            <div className="flex flex-col justify-center w-[80%]">
                                <p className="transition-colors duration-150 font-progRegular text-[18px] text-white group-hover:text-black">
                                    {job.title}
                                </p>
                                <p className="transition-colors duration-150 font-progRegular text-[18px] text-white group-hover:text-black opacity-50">
                                    {job.location}
                                </p>
                            </div>
                            <img
                                src={`jobboard/apply/${imageNumbers[index]}.webp`}
                                alt={`Job ${job.title}`}
                                className="w-[20%]"
                            />
                        </div>
                        </a>
                    ))}
                </div>
                <img src="jobboard/jobboard-bottom.webp" className="w-full h-full" />
            </div>

            <div className="absolute bottom-0 left-0 h-[50px] w-screen bg-[#F0EDE8]" />
        </div>
    );
}
